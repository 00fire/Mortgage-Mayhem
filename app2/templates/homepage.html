{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homepage</title>
  <link rel="stylesheet" href="{% static 'homepage.css' %}">
</head>
<body>

  <h1>Homepage</h1>

  {% if request.user.is_authenticated %}
    <a href="{% url 'profile_info' %}" class="fixed">
      <img class="profile-icon"
           src="{{ request.user.profile.profile_picture.url }}"
           alt="{{ request.user.username }}">
    </a>
  {% endif %}

  <!-- Simplified Search and Filter Form -->
  <form method="get" action="{% url 'homepage' %}" class="search-form">
    <input type="text" name="q" placeholder="Search city, country..." value="{{ current_query }}">

    <div class="filters">
      <input type="text" name="street_name" placeholder="Street name" value="{{ street_name }}">
      <input type="text" name="postal_code" placeholder="Postal code" value="{{ postal_code }}">
      <input type="text" name="property_type" placeholder="Type" value="{{ property_type }}">

      <input type="number" name="min_price" placeholder="Min price" value="{{ min_price }}">
      <input type="number" name="max_price" placeholder="Max price" value="{{ max_price }}">

      <select name="order_by">
        <option value="">Order by</option>
        <option value="price" {% if order_by == 'price' %}selected{% endif %}>Price</option>
        <option value="name" {% if order_by == 'name' %}selected{% endif %}>Name</option>
      </select>
    </div>

    <button type="submit" class="btn">Search</button>
  </form>

  <hr>

  <div class="property-container">
    {% if properties.exists %}
      {% for property in properties %}
        <div class="property-item">

          <div class="property-header">
            <h2>{{ property.property_city }}</h2>
            <p class="listed-date">Listed: {{ property.listed_at|date:"M j, Y" }}</p>
          </div>

          <div class="property-contents">

            {% with thumb=property.images.first %}
              {% if thumb %}
                <a href="{% url 'property_detail' property.id %}">
                  <img src="{{ thumb.image.url }}"
                       alt="{{ property.property_city }}"
                       class="card-img">
                </a>
              {% elif property.property_image %}
                <a href="{% url 'property_detail' property.id %}">
                  <img src="{{ property.property_image.url }}"
                       alt="{{ property.property_city }}"
                       class="card-img">
                </a>
              {% else %}
                <a href="{% url 'property_detail' property.id %}">
                  <img src="{% static 'images/default-thumb.png' %}"
                       alt="No image"
                       class="card-img">
                </a>
              {% endif %}
            {% endwith %}

            {% if property.property_sold_status %}
              <div class="sold-ribbon">Sold</div>
            {% endif %}

            <div class="property-text-box">
              <p class="property-text">${{ property.property_price }}</p>
              <p class="property-text">postal : {{ property.property_postal }}</p>
              <p class="property-text">street : {{ property.property_street }}</p>
              <p class="property-text">rooms : {{ property.property_rooms }}</p>
              <a href="{% url 'property_detail' property.id %}" class="btn">
                View Details
              </a>
            </div>

          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="no-results">No properties found matching your criteria.</p>
    {% endif %}
  </div>

</body>
</html>