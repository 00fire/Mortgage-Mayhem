{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homepage</title>
  <link rel="stylesheet" href="{% static 'homepage.css' %}">
</head>
<body>

  {% include "global_header.html" %}

  <hr>

  <main class="page-content">
    <div class="property-container">
      {% if properties.exists %}
        {% for property in properties %}
          <div class="property-item">

            <!-- Header Info -->
            <div class="property-header">
              <h2>{{ property.property_city }}</h2>
              <p class="listed-date">Listed: {{ property.listed_at|date:"M j, Y" }}</p>
            </div>

            <!-- Property Card -->
            <div class="property-card">

              <!-- Image Preview in wrapper -->
              <div class="img-wrapper">
                {% with thumb=property.images.first %}
                  {% if thumb %}
                    <a href="{% url 'property_detail' property.id %}">
                      <img src="{{ thumb.image.url }}"
                           alt="{{ property.property_city }}"
                           class="card-img">
                    </a>
                  {% elif property.property_image %}
                    <a href="{% url 'property_detail' property.id %}">
                      <img src="{{ property.property_image.url }}"
                           alt="{{ property.property_city }}"
                           class="card-img">
                    </a>
                  {% else %}
                    <a href="{% url 'property_detail' property.id %}">
                      <img src="{% static 'images/default-thumb.png' %}"
                           alt="No image available"
                           class="card-img">
                    </a>
                  {% endif %}
                {% endwith %}
              </div>

              {% if property.property_sold_status %}
                <div class="sold-ribbon">Sold</div>
              {% endif %}

              <!-- Description -->
              <div class="property-text-box">
                <p class="property-text"><strong>${{ property.property_price }}</strong></p>
                <p class="property-text">Rooms: {{ property.property_rooms }}</p>
                <p><strong>Seller:</strong> {{ property.seller.username }}</p>
                {% if property.property_description %}
                  <p class="property-description">{{ property.property_description|truncatechars:100 }}</p>
                {% endif %}
                <a href="{% url 'property_detail' property.id %}" class="btn">View Details</a>
                <p>{{ property.property_bio }}</p>
              </div>

            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="no-results">No properties found matching your criteria.</p>
      {% endif %}
    </div>
  </main>

</body>
</html>
